{% extends 'base.html' %} 
{% load static %} 

{% block head %}
<script src="
https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js
"></script>
{% endblock head %}

{% block style %}
<link
  rel="stylesheet"
  type="text/css"
  href="{% static 'CSS/studies/mainboard.css' %}"
/>
{% endblock style %} 

{% block content %}
<a href="{% url 'studies:detail' study.pk %}">
  <div class="main__title">
    {{ study.title}}
  </div>
</a>
<div class="main__wrapper">
  <aside class="aside__container">
    <div class="aside__item" data-content="mainboard">ëŒ€ì‹œë³´ë“œ</div>
    <div class="aside__item" data-content="problem">í•™ìŠµê´€ë¦¬</div>
    {% if request.user == study.user %}
    <div class="aside__item" data-content="member">ìŠ¤í„°ë”” ê´€ë¦¬</div>
    {% endif %}
    
    <section class="memberInfo__container">
      <div class="memberInfo-title">
        Study Crew
      </div>
      <hr>
      {% for user in users %}
      {% if user == study.user and user == request.user %}
          <div class="memberInfo-username leader"> {{user.emoji_username}} - ë¦¬ë”</div>
      {% elif user == study.user and user != request.user  %}
          <div class="memberInfo-username"> {{user.emoji_username}} - ë¦¬ë”</div>
      {% elif user != study.user and user == request.user  %}
          <div class="memberInfo-username leader"> {{user.emoji_username}}</div>
      {% else %}
          <div class="memberInfo-username"> {{user.emoji_username}}</div>
      {% endif %}
      {% endfor %}
    </section>
    {% if request.user != study.user %}
      <form action="{% url 'studies:withdraw' study.pk %}" method="post">
        {% csrf_token %}
        <button type"submit" class="study-expel">ìŠ¤í„°ë”” íƒˆí‡´</button>
      </form>
    {% endif %}
  </aside>

  <section class="right-content__container">
    {% block right_content %}
    {% endblock right_content %}
    {#ê³µì§€ì‚¬í•­#}
    <section class="right_content-item__wrapper">
      
      {% if request.user == study.user %}
        <div class="right-align">
          <a href="{% url 'studies:announcement_create' study.pk%}">
            <button class="create-btn button-small">ìƒˆ ê³µì§€í•˜ê¸°</button>
          </a>
        </div>
      {% endif %}
      <a href="{% url 'studies:announcement' study.pk %}">
        <div class="right_content-title">ğŸ“Œ ê³µì§€ì‚¬í•­ ></div>
      </a>
    {% if announcements %}
      {% for announcement in announcements  %}
        <a href="{% url 'studies:announcement_detail' study.pk announcement.pk %}">
          <div class="announcement__container">
            <div class="announcement-title">{{announcement.title}}</div>
            <div class="announcement-content">{{announcement.content}}</div>
            <div class="announcement-date">{{announcement.updated_at}}</div>
          </div>
        </a>
        <hr>
        {% endfor %}
        {% else %}
          <div class="null-message">ğŸ² í¬ë£¨ë“¤ê³¼ ê³µì§€ì‚¬í•­ì„ ê³µìœ í•´ë³´ì„¸ìš”!</div>
    {% endif %}
    </section>
    {#í†µê³„#}
    <section class="right_content-item__wrapper">
      <div class="right_content-title">ğŸ† ìš°ë¦¬ í•¨ê»˜ ì„±ì¥í•˜ëŠ” ë¦¬ë”ë³´ë“œ</div>
      <div class="ranking__wrapper">
        {# ë¦¬ë·° ì‘ì„±ë¥  #}
        <section class="ranking-item__container">
          <canvas id="reviewsRate-chart"></canvas>
          {{ user_percentages | json_script:'user_percentages' }}
          <div class="ranking-item-title">ì„±ì‹¤ì™•</div>
        </section>
        {# ë¦¬ë·° ì¢‹ì•„ìš” #}
        <section class="ranking-item__container">
          <canvas id="reviewsLikesRate-chart"></canvas>
          {{ user_review_likes_percentage | json_script:'user_review_likes_percentage' }}
          <div class="ranking-item-title">ì½”ë“œì™•</div>
        </section>
      
      </div>
      </section>
    {#ì œì¶œí•´ì•¼í•  ê³¼ì œ#}
    <section class="right_content-item__wrapper">
      <div class="right-align">
        <a href="{% url 'reviews:create' %}?study={{ study.pk }}">
          <button class="create-btn button-small">ë¬¸ì œ ë“±ë¡í•˜ê¸°</button>
        </a>
      </div>
      <div class="right_content-title">âŒ› ì´ë²ˆì£¼ ë¬¸ì œ</div>
      {% if problems %}
        {% for problem in problems %}
        <div class="problem__container">
          <a href="{% url 'reviews:detail' problem.pk %}">
            <div class="problem-title">{{ problem }}</div>
            <div class="problem-reviewsCount">
              {% if problem.review_set.count %}
              ì´ <span>{{ problem.review_set.count }}</span>ê°œì˜ ë‹µë³€ì´ ìˆìŠµë‹ˆë‹¤.
              {% else %}
              ğŸ² ê°€ì¥ ë¨¼ì € ì½”ë“œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!
              {% endif %}
            </div>
            <div class="problem-date">{{ problem.updated_at }}</div>
          </a>
        </div>
        <hr>
        {% endfor %}
      {% else %}
      <div class="null-message">ğŸ² ì´ë²ˆì£¼ ë¬¸ì œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</div>
      {% endif %}
    </section>
  </section>
</div>


<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script type="module" src="{% static 'JS/aside.js' %}"></script>
<script src="{% static 'JS/ranking.js' %}"></script>
{% endblock content %}
